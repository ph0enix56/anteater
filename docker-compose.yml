version: '3.8'
services:
    mongodb:
        image: mongo
        ports:
            - 27017:27017
        volumes:
            - mongodb_data:/data/db
    script:
        build:
            context: .
            dockerfile: Dockerfile_script
        depends_on:
            - mongodb
    app:
        build:
            context: .
            dockerfile: Dockerfile_app
        # TODO: Spring Boot can't read the env variable, it needs to be set in application.properties
        # TODO: all attempts to fix this here or in Dockerfile failed :(
        environment:
            - MONGODB_URI=mongodb://mongodb:27017/dnd_dev
        ports:
            - 8080:8080
        depends_on:
            - mongodb
volumes:
    mongodb_data:
